+++
date = "2016-07-01T10:53:00+03:00"
author = "Alan Orth"
title = "July, 2016"
tags = ["notes"]
image = "../images/bg.jpg"

+++
## 2016-07-01

- Add `dc.description.sponsorship` to Discovery sidebar facets and make investors clickable in item view ([#232](https://github.com/ilri/DSpace/issues/232))
- I think this query should find and replace all authors that have "," at the end of their names:

```
dspacetest=# update metadatavalue set text_value = regexp_replace(text_value, '(^.+?),$', '\1') where metadata_field_id=3 and text_value ~ '^.+?,$';
UPDATE 95
dspacetest=# select text_value from  metadatavalue where metadata_field_id=3 and text_value ~ '^.+?,$';
 text_value
------------
(0 rows)
```

- In this case the select query was showing 95 results before the update

## 2016-07-02

- Comment on DSpace Jira ticket about author lookup search text ([DS-2329](https://jira.duraspace.org/browse/DS-2329))

## 2016-07-04

- Seems the database's author authority values mean nothing without the `authority` Solr core from the host where they were created!

## 2016-07-05

- Amend `backup-solr.sh` script so it backs up the entire Solr folder
- We *really* only need `statistics` and `authority` but meh
- Fix metadata for species on DSpace Test:

```
$ ./fix-metadata-values.py -i /tmp/Species-Peter-Fix.csv -f dc.Species -t CORRECT -m 94 -d dspacetest -u dspacetest -p 'fuuu'
```

- Will run later on CGSpace
- A user is still having problems with Sherpa/Romeo causing crashes during the submission process when the journal is "ungraded"
- I tested the [patch for DS-2740](https://jira.duraspace.org/browse/DS-2740) that I had found last month and it seems to work
- I will merge it to `5_x-prod`

## 2016-07-06

- Delete 23 blank metadata values from CGSpace:

```
cgspace=# delete from metadatavalue where resource_type_id=2 and text_value='';
DELETE 23
```

- Complete phase three of metadata migration, for the following fields:
  - dc.title.jtitle → dc.source
  - dc.crsubject.crpsubject → cg.contributor.crp
  - dc.contributor.affiliation → cg.contributor.affiliation
  - dc.Species → cg.species
  - dc.srplace.subregion → cg.coverage.subregion
  - dc.contributor.corporate → dc.contributor.author
  - dc.identifier.url → cg.identifier.url
  - dc.identifier.doi → cg.identifier.doi
  - dc.identifier.googleurl → cg.identifier.googleurl
  - dc.identifier.dataurl → cg.identifier.dataurl
- Also, run fixes and deletes for species and author affiliations (over 1000 corrections!)

```
$ ./fix-metadata-values.py -i Species-Peter-Fix.csv -f dc.Species -t CORRECT -m 212 -d dspace -u dspace -p 'fuuu'
$ ./fix-metadata-values.py -i Affiliations-Fix-1045-Peter-Abenet.csv -f dc.contributor.affiliation -t Correct -m 211 -d dspace -u dspace -p 'fuuu'
$ ./delete-metadata-values.py -f dc.contributor.affiliation -i Affiliations-Delete-Peter-Abenet.csv -m 211 -u dspace -d dspace -p 'fuuu'
```

- I then ran all server updates and rebooted the server

## 2016-07-11

- Doing some author cleanups from Peter and Abenet:

```
$ ./fix-metadata-values.py -i /tmp/Authors-Fix-205-UTF8.csv -f dc.contributor.author -t correct -m 3 -d dspacetest -u dspacetest -p fuuu
$ ./delete-metadata-values.py -f dc.contributor.author -i /tmp/Authors-Delete-UTF8.csv -m 3 -u dspacetest -d dspacetest -p fuuu
```
